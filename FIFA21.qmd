---
title: "FIFA 21 Analysis"
author: "Nathan Weldon"
format: pdf
editor: visual
---

## Introduction

Here, I will load in packages and narrow down what I want to work with for this dataset.

```{r include = FALSE}
library(tidyverse)
library(janitor)
data <- fifa21_raw_data %>% 
  select(-c(photoUrl,playerUrl, `Loan Date End`, `Release Clause`)) %>% 
  clean_names()

```

## Practice

Checkout the `Team & Contract` column and separate by how long they have their contract period and their club. Then, find which players have played at a club for more than 10 years:

```{r}
#clean
teamtime <- data %>% 
  drop_na() %>% 
  mutate('contract' = str_sub(team_contract, start = -13)) %>% 
  mutate('team' = str_sub(team_contract, start = 1, end = -15)) %>% 
  select(-c(team_contract))

#players 10+ years
a <- str_sub(teamtime$contract, start = -4, end = -3) %>% 
  as.numeric()
b <- str_sub(teamtime$contract, start = 3, end = 4) %>% 
  as.numeric()

decades <- teamtime %>% 
  mutate('Years_at_club'= a-b) %>% 
  filter(c(a-b) >= 10) %>% 
  select(c(name, Years_at_club))

tibble(decades)
```

Which positions get paid the most? Create a plot that displays this data:

```{r}
costs <- data %>% 
  drop_na() %>% 
  mutate('wage_thousands' = str_extract(wage, "[0-9]+\\.*[0-9]+")) %>% 
  select(74,bp)

worth <- costs %>% 
  drop_na() %>%
  group_by(bp) %>% 
  summarize('n' = mean(as.numeric(wage_thousands))) %>% 
  tibble(value = (n * 1.15) * 100,
          overall = mean(bp))

worth %>% ggplot(aes(x = bp, y = value)) + 
  geom_col(fill = 'chartreuse3') +
  labs(title = 'Position vs wage',
       subtitle ='Looking at the average wage (USD) per position',
       x = 'Position',
       y = 'Average Wage')


```

Let's observe at who is the best technically. Find out who is the best overall, has the best individual characteristic on a FIFA Card (pace,shooting, passing, dribbling, defending, physical) and who is the best overall right / left foot.

```{r}
#overall
overall <- data %>% 
  drop_na() %>% 
  filter(bp != 'GK') %>% 
  filter(ova == max(ova)) %>% 
  select(name, bp, ova) 
#pace
pace <- data %>% 
  drop_na() %>% 
  filter(bp != 'GK') %>% 
  filter(pac == max(pac)) %>% 
  select(name, bp, pac)
#shooting
shooting <- data %>% 
  drop_na() %>% 
  filter(bp != 'GK') %>% 
  filter(sho == max(sho)) %>% 
  select(name, bp, sho)
#passing
passing <- data %>% 
  drop_na() %>% 
  filter(bp != 'GK') %>% 
  filter(pas == max(pas)) %>% 
  select(name, bp, pas)
#dribbling
dribbling <- data %>% 
  drop_na() %>% 
  filter(bp != 'GK') %>% 
  filter(dri == max(dri)) %>% 
  select(name, bp, dri)
#defending 
defend <- data %>% 
  drop_na() %>% 
  filter(bp != 'GK') %>% 
  filter(def == max(def)) %>% 
  select(name, bp, def)
#physical
physical <- data %>% 
  drop_na() %>% 
  filter(bp != 'GK') %>% 
  filter(phy == max(phy)) %>% 
  select(name, bp, phy)
#right
rightf <- data %>% 
  drop_na() %>%
  filter(bp != 'GK') %>% 
  filter(foot == 'Right') %>% 
  filter(ova == max(ova)) %>% 
  select(name, foot, ova)
#left
leftf <- data %>% 
  drop_na() %>%
  filter(bp != 'GK') %>% 
  filter(foot == 'Left') %>% 
  filter(ova == max(ova)) %>% 
  select(name, foot, ova)

overall
pace
shooting
passing
dribbling
defend
physical
rightf
leftf
```

Is there a correlation between:

a\) age and overall rating?

b\) aggression and defending?

c\) weight and pace?

d\) height and heading?

```{r}
#age and overall rating
data %>% 
  ggplot(mapping = aes(x = age, y = ova, color = foot)) + 
  geom_jitter() 
cor(data$age, data$ova)


```

*Conclusions*:

There seems a moderately strong, positive correlation between age and the overall rating, in that the older a player is, the higher the rating will be, on average. From the graph, the points are generally following this trend confirmed by the correlation being .46. I added in the dominant foot for the aesthetic and to see if it played a role in the correlation between the two, and it did not have any noticeable impact.

```{r}
#aggression and defending
data %>% 
  ggplot(mapping = aes(x = aggression, y = def)) + 
  geom_jitter()
cor(data$aggression, data$def)
```

*Conclusions*:

The data above demonstrates that the more aggressive a player is, the better defender they will be based on the strong and positive correlation of .66. In reality this seems to be related because as a defender, it is imperative that you are aggressive when confronted with an attacker or a ball that you can win.

```{r}
#weight and pace rating
paclbs <- data %>% 
  mutate('Weight' = str_extract(weight, "[0-9]+")) %>% 
  mutate('lbs' = as.numeric(Weight))
paclbs %>% 
  ggplot(mapping = aes(x = pac, y = lbs)) + 
  geom_jitter()
cor(paclbs$lbs, paclbs$pac)

```

*Conclusions*:

This comparison between the weight of a player and how fast the player is, does not seem to have much magnitude in terms of correlation (-.32). The negative symbol is interesting, because it means that the less weight you are, the faster you will be, which makes practical sense as well as the similarity of the graph. I wonder why this would not be a higher correlation.

```{r}
#height and heading
inches <- data %>%
  drop_na() %>%
  mutate('n' = as.numeric(str_sub(height, start=1, end = 1))) %>% 
  mutate('n1' = as.numeric(str_sub(height, start = 3, end = -2))) %>%
  mutate('ht' = (n * 12) + n1) %>%
  select(heading_accuracy, n,  n1, ht)
inches %>% 
  ggplot(mapping = aes(x = heading_accuracy, y = ht)) +
  geom_jitter()
cor(inches$heading_accuracy, inches$ht)
```
